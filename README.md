# Вебсайт "Куда сходить"

 Интерактивная карта Москвы, на которой показаны места, где предлагается проведение активного отдыха, с подробными описаниями и комментариями. 

## Где посмотреть
 Вы можете посмотреть пример работы сайта по адресу [breath.pythonanywhere.com](https://breath.pythonanywhere.com/)
 
 ### Добавление данных через административную часть сайта

 - Перейдите в админку по адресу [breath.pythonanywhere.com/admin](breath.pythonanywhere.com/admin)
 - Введите данные аккаунта администратора.

 В разделе `Места` добавьте новое место и заполните название, описание, координаты. Добавьте фотографии. 
 Можно менять порядок фотографий, просто перетаскивая их в списке.
 

## Для разработчиков
 ### Как установить

 У вас должен быть установлен Python3. Скачайте репозиторий.  
 Установите зависимости:
 ```
 pip install requirements.txt
 ```
 Настройте переменные окружения. Для этого создайте файл `.env` в корне проекта рядом с файлом `manage.py`.
 Запишите в этот файл секретный ключ своего проекта:
 ```
 SECRET_KEY=[SECRET_KEY]
 ```

 ### Запуск

 Для запуска со своего компьютера создайте базу данных в формате `.sqlite3`, установив миграции:
 ```
 python migrate
 ```
 Создайте аккаунт администратора:
 ```
 python createsuperuser
 ```
 Запустите сервер:
 ```
 python runserver
 ```
 По умолчанию сайт доступен по адресу [http://127.0.0.1:8000/](http://127.0.0.1:8000/).

 
 ### Деплой и доработка
 В файле `.env` вы можете указать следующие параметры:
 `DEBUG` - режим отладки. Принимает булевое значение. По умолчанию - False.
 `ALLOWED_HOSTS` - При деплое нужно через запятую перечислить имена доменов, на которых будет размещен сайт.

 Данные для объектов на карте формируются в виде JSON и передаются на фронтенд:
 ```python
 # places/views.py

 def index_map(request):
    template = 'index_map.html'
    places_geojson = {
            'type': 'FeatureCollection',
            'features': [],
    }
    for place in Place.objects.all():
        feature = {
            'type': 'Feature',
            'geometry': {
                'type': 'Point',
                'coordinates': [place.lng, place.lat],
            },
            'properties': {
                'title': place.title,
                'placeId': place.placeId,
                'detailsUrl': reverse('place_details', args=[place.id])
            },
        }
        places_geojson['features'].append(feature)
    context = {'places_geojson': places_geojson}
    
    return render(request, template, context=context)
 ```
 Данные передаются в [формате GeoJSON](https://ru.wikipedia.org/wiki/GeoJSON). Все поля здесь стандартные, кроме `properties`. Внутри `properties` лежат специфичные для проекта данные:

* `title` — название локации
* `placeId` — уникальный идентификатор локации, строка или число
* `detailsUrl` — адрес для скачивания доп. сведений о локации в JSON формате

 Значение поля `placeId` может быть либо строкой, либо числом. Само значение не играет большой роли, важна лишь чтобы оно было уникальным. Фронтенд использует `placeId`, чтобы избавиться от дубликатов — если у двух локаций одинаковый `placeId`, то значит это одно и то же место.  

 В поле `detailsUrl` передается ссылка на JSON c подробными сведениями о локации.
 ```json
 {
    "title": "Экскурсионный проект «Крыши24.рф»",
    "imgs": [
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/af7b8599fec9d2542a011f1d01d459e2.jpg",
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/965c5a3ff5b2431e646d30b6744afd2d.jpg",
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/06868b2b01ff8db506cd21956a6cb636.jpg",
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/a8cc3e03f56413275ded99e51226a70f.jpg",
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/44e96733303e7490aaa1cf2eebfbbfff.jpg",
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/fadf618505b087fa539e883f33f850b2.jpg",
        "https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/media/ec461a89a1d0d5a4cb7c81f1fc0a4e89.jpg"
    ],
    "description_short": "Хотите увидеть Москву с высоты и разделить яркие впечатления с друзьями? В этом поможет проект «Крыши24.рф». Вы можете выбрать крышу из множества интересных вариантов и провести там свидание, вечеринку, творческое занятие, фотосессию или что-то ещё.",
    "description_long": "<p>Проект «Крыши24.рф» проводит экскурсии и мероприятия на крышах, откуда открываются впечатляющие виды на мегаполис. </p><h4>Экскурсии на высоте</h4><p>Список крыш, на которые можно подняться, очень велик, и находятся они в разных уголках города. Оттуда видны достопримечательности и красивейшие городские панорамы, так что это отличная возможность заново открыть для себя Москву. Экскурсии безопасны, на эти крыши можно подниматься с детьми. Перед подъёмом опытный гид проведёт инструктаж и будет сопровождать вас во время прогулки.</p><p>С крыш, доступных для посещения, вы увидите «Москва Сити» вблизи, стадион «Лужники», Новодевичий монастырь, Красную и Киевскую площади, мост Богдана Хмельницкого, сталинские высотки, Новый Арбат, и многие другие знаковые места столицы. </p><p>Стоимость экскурсии — 1250 рублей, продолжительность — 1 час. В стоимость экскурсии включены услуги гида.</p><h4>Свидания на высоте птичьего полёта</h4><p>А ещё «Крыши24.рф» — настоящая находка для тех, кто хочет устроить незабываемое романтическое свидание. Выбирайте свой вариант из пяти крыш, расположенных рядом с главными достопримечательностями, и удивите любимого человека. </p><p>На крыше для вас устроят зону отдыха с пледами и подушками. В стоимость также входят свечи, цветок, бокалы, столовые приборы, фруктовая тарелка и напиток. А если ваше событие более строгое и торжественное, то для вас поставят праздничный стол и стулья. За дополнительную плату вы можете заказать букет цветов, воздушные шары, музыканта, виниловый проигрыватель, салют, напитки и еду. </p><p>Базовая стоимость свидания — 5500 рублей, продолжительность — 2 часа.</p><p><strong>Фотосессии над Москвой</strong></p><p>Необычным подарком для себя и для любимых может стать фотосессия на крышах. Из полусотни вариантов крыш вам помогут выбрать ту, которая подойдёт именно вам. На сессии будет работать профессиональный руфер-фотограф с опытом более 10 лет. В итоге вы получите около 100 фотоснимков, 15 из них — уже обработанными, так что их можно будет сразу выкладывать в соцсети и удивлять друзей.</p><p>Стоимость фотосессии — от 4000 рублей, продолжительность — 1 час. </p><p>Также проект «Крыши24.рф» организует девичники, вечеринки, творческие мероприятия и многое другое.</p><p>Узнать подробности можно на <a class=\"external-link\" href=\"https://www.крыши24.рф/\" target=\"_blank\">официальном сайте</a> и в <a class=\"external-link\" href=\"https://instagram.com/roof24_moscow/\" target=\"_blank\">Instagram</a>.</p>",
    "coordinates": {
        "lng": "37.32478399999957",
        "lat": "55.70731600000015"
    }
 }
 ```

 ### Автоматическое добавление нового места
 В программе предусмотрен скрипт, который добавляет новое место, использую данные из файла JSON в формате `detailsUrl`,
 как в примере выше. Для этого нужно ввести команду:
 ```
 python manage.py load_place <http://адрес/файла_1.json> <http://адрес/файла_2.json> <http://адрес/файла_3.json> ...
 ```
 Адреса перечисляются через пробел.  
 Скрипт подставляет в поле `geometry.coordinates` значение из соответствующих полей загружаемого JSON, а в поля `properties.title` и `properties.placeId` подставляется `title`. При этом `placeId` остается уникальным.

## Цели проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org).

Тестовые данные на примере сайта взяты с сайта [KudaGo](https://kudago.com).
